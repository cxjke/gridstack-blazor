@page "/demo2"

<div class="page">

    <div class="header">
        <button class="button" @onclick="@OnAddWidget">Add widget</button>
    </div>

    <div class="grid-wrapper">
        <div class="grid-enabled">

            <GsGrid @ref="@_grid" Options="@_gsGridOptions">

                @foreach (var widget in _widgets)
                {
                    <GsWidget Options="@ToOptions(widget)">
                        @widget.Id
                    </GsWidget>
                }

            </GsGrid>

        </div>
    </div>

</div>

@code {

    private sealed record WidgetHolder
    {
        public required string Id { get; init; }

        public uint W { get; init; }

        public uint H { get; init; }

        public bool IsAdded { get; set; }
    }

    private readonly List<WidgetHolder> _widgets = new();

    private readonly GsGridOptions _gsGridOptions = new()
    {
        Float = true,
        MaxRow = 6,
        MinRow = 1
    };

    private static GsWidgetOptions ToOptions(WidgetHolder widget)
    {
        return new GsWidgetOptions
        {
            Id = widget.Id,
            W = widget.W,
            H = widget.H,
            AutoPosition = true
        };
    }

    private GsGrid _grid = null!;
    
    private void OnAddWidget()
    {
        var widget = new WidgetHolder
        {
            Id = Guid.NewGuid().ToString(),
            W = 2,
            H = 1
        };
        
        _widgets.Add(widget);
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        foreach (var widget in _widgets)
        {
            if (widget.IsAdded)
            {
                continue;
            }

            Console.WriteLine($"adding {widget.Id}");
                
            var gridWidget = await _grid.MakeWidget(widget.Id);
            widget.IsAdded = true;

            Console.WriteLine($"added widget {gridWidget}");
        }
    }
}